module.exports = {

"[externals]/next/dist/compiled/next-server/app-route.runtime.dev.js [external] (next/dist/compiled/next-server/app-route.runtime.dev.js, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: __turbopack_require_real__ } = __turbopack_context__;
{
const mod = __turbopack_external_require__("next/dist/compiled/next-server/app-route.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/next/dist/compiled/@opentelemetry/api [external] (next/dist/compiled/@opentelemetry/api, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: __turbopack_require_real__ } = __turbopack_context__;
{
const mod = __turbopack_external_require__("next/dist/compiled/@opentelemetry/api", () => require("next/dist/compiled/@opentelemetry/api"));

module.exports = mod;
}}),
"[externals]/next/dist/compiled/next-server/app-page.runtime.dev.js [external] (next/dist/compiled/next-server/app-page.runtime.dev.js, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: __turbopack_require_real__ } = __turbopack_context__;
{
const mod = __turbopack_external_require__("next/dist/compiled/next-server/app-page.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: __turbopack_require_real__ } = __turbopack_context__;
{
const mod = __turbopack_external_require__("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: __turbopack_require_real__ } = __turbopack_context__;
{
const mod = __turbopack_external_require__("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: __turbopack_require_real__ } = __turbopack_context__;
{
const mod = __turbopack_external_require__("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/sharp [external] (sharp, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: __turbopack_require_real__ } = __turbopack_context__;
{
const mod = __turbopack_external_require__("sharp", () => require("sharp"));

module.exports = mod;
}}),
"[project]/app/api/analyze/route.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, z: __turbopack_require_stub__ } = __turbopack_context__;
{
__turbopack_esm__({
    "POST": (()=>POST)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$externals$5d2f$sharp__$5b$external$5d$__$28$sharp$2c$__cjs$29$__ = __turbopack_import__("[externals]/sharp [external] (sharp, cjs)"); // Use sharp for image processing
;
;
async function POST(request) {
    try {
        const formData = await request.formData();
        const file = formData.get("file");
        if (!file || !(file instanceof Blob)) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: "Invalid file input"
            }, {
                status: 400
            });
        }
        const buffer = Buffer.from(await file.arrayBuffer());
        // Process image using sharp
        const image = (0, __TURBOPACK__imported__module__$5b$externals$5d2f$sharp__$5b$external$5d$__$28$sharp$2c$__cjs$29$__["default"])(buffer);
        const metadata = await image.metadata();
        const { width, height } = metadata;
        if (!width || !height) {
            throw new Error("Failed to read image dimensions");
        }
        const rawPixelData = await image.raw().toBuffer(); // Get raw pixel data
        const metrics = analyzeImage(rawPixelData, width, height);
        const overallQuality = determineWaterQuality(metrics);
        const safetyStatus = assessWaterSafety(metrics);
        const recommendations = generateRecommendations(metrics, safetyStatus);
        const result = {
            overallQuality,
            metrics,
            recommendations,
            safetyStatus
        };
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json(result, {
            status: 200
        });
    } catch (error) {
        console.error("Error processing image:", error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: "Failed to analyze the image"
        }, {
            status: 500
        });
    }
}
function analyzeImage(pixelData, width, height) {
    let colorTotals = {
        red: 0,
        green: 0,
        blue: 0,
        brightness: 0,
        saturation: 0,
        variance: 0
    };
    const totalPixels = width * height;
    // First pass: calculate averages
    for(let i = 0; i < pixelData.length; i += 4){
        const red = pixelData[i];
        const green = pixelData[i + 1];
        const blue = pixelData[i + 2];
        colorTotals.red += red;
        colorTotals.green += green;
        colorTotals.blue += blue;
        colorTotals.brightness += (red + green + blue) / 3;
        const max = Math.max(red, green, blue);
        const min = Math.min(red, green, blue);
        colorTotals.saturation += max > 0 ? (max - min) / max : 0;
    }
    const averages = {
        red: colorTotals.red / totalPixels,
        green: colorTotals.green / totalPixels,
        blue: colorTotals.blue / totalPixels,
        brightness: colorTotals.brightness / totalPixels,
        saturation: colorTotals.saturation / totalPixels,
        variance: 0
    };
    // Second pass: calculate variance
    for(let i = 0; i < pixelData.length; i += 4){
        const red = pixelData[i];
        const green = pixelData[i + 1];
        const blue = pixelData[i + 2];
        colorTotals.variance += Math.pow(red - averages.red, 2) + Math.pow(green - averages.green, 2) + Math.pow(blue - averages.blue, 2);
    }
    averages.variance = Math.sqrt(colorTotals.variance / (totalPixels * 3));
    return {
        ph: calculatePH(averages),
        turbidity: calculateTurbidity(averages),
        dissolvedOxygen: calculateDissolvedOxygen(averages),
        temperature: calculateTemperature(averages),
        conductivity: calculateConductivity(averages),
        totalDissolvedSolids: calculateTDS(averages),
        chlorine: calculateChlorine(averages),
        hardness: calculateHardness(averages)
    };
}
function calculatePH(averages) {
    const rgRatio = averages.red / averages.green;
    const bModifier = averages.blue / 255;
    const baseValue = 7 + (rgRatio - 1) * 3.5;
    return Math.max(0, Math.min(14, baseValue + (bModifier - 0.5)));
}
function calculateTurbidity(averages) {
    const brightnessComponent = (255 - averages.brightness) / 6.375;
    const varianceComponent = averages.variance / 30;
    return Math.max(0, Math.min(40, brightnessComponent + varianceComponent));
}
function calculateDissolvedOxygen(averages) {
    return Math.max(0, Math.min(15, averages.blue / 255 * 10 + averages.saturation * 5));
}
function calculateTemperature(averages) {
    return Math.max(0, Math.min(40, averages.red / 255 * 40));
}
function calculateConductivity(averages) {
    return Math.max(0, Math.min(2000, averages.variance * 5 + averages.brightness / 255 * 1000));
}
function calculateTDS(averages) {
    return Math.max(0, Math.min(1000, averages.brightness / 255 * 500 + averages.variance * 2));
}
function calculateChlorine(averages) {
    return Math.max(0, Math.min(4, (averages.green - averages.blue) / 255 * 4));
}
function calculateHardness(averages) {
    return Math.max(0, Math.min(300, (averages.red + averages.green) / (2 * 255) * 300));
}
function determineWaterQuality(metrics) {
    const scores = {
        ph: scoreInRange(metrics.ph, 6.5, 8.5),
        turbidity: scoreInRange(metrics.turbidity, 0, 5),
        dissolvedOxygen: scoreInRange(metrics.dissolvedOxygen, 6, 8),
        tds: scoreInRange(metrics.totalDissolvedSolids, 0, 500),
        chlorine: scoreInRange(metrics.chlorine, 0.2, 2),
        hardness: scoreInRange(metrics.hardness, 60, 180)
    };
    const averageScore = Object.values(scores).reduce((a, b)=>a + b) / Object.keys(scores).length;
    if (averageScore >= 0.9) return "Excellent";
    if (averageScore >= 0.7) return "Good";
    if (averageScore >= 0.5) return "Fair";
    return "Poor";
}
function scoreInRange(value, min, max) {
    if (value >= min && value <= max) return 1;
    const midpoint = (min + max) / 2;
    const deviation = Math.abs(value - midpoint) / (max - min);
    return Math.max(0, 1 - deviation);
}
function assessWaterSafety(metrics) {
    const isDrinkable = metrics.ph >= 6.5 && metrics.ph <= 8.5 && metrics.turbidity <= 1 && metrics.dissolvedOxygen >= 6 && metrics.totalDissolvedSolids <= 500 && metrics.chlorine >= 0.2 && metrics.chlorine <= 4;
    const isSwimmable = metrics.ph >= 6.0 && metrics.ph <= 9.0 && metrics.turbidity <= 5 && metrics.dissolvedOxygen >= 4;
    const isIrrigationSafe = metrics.ph >= 6.0 && metrics.ph <= 8.5 && metrics.totalDissolvedSolids <= 2000;
    return {
        isDrinkable,
        isSwimmable,
        isIrrigationSafe
    };
}
function generateRecommendations(metrics, safety) {
    const recommendations = [];
    if (!safety.isDrinkable) {
        if (metrics.ph < 6.5 || metrics.ph > 8.5) {
            recommendations.push(`pH level (${metrics.ph.toFixed(1)}) is outside safe drinking range. Consider pH adjustment.`);
        }
        if (metrics.turbidity > 1) {
            recommendations.push("Water turbidity is high. Filtration recommended before consumption.");
        }
        if (metrics.chlorine < 0.2) {
            recommendations.push("Chlorine levels are low. Consider additional disinfection.");
        }
    }
    if (metrics.hardness > 180) {
        recommendations.push("Water is very hard. Consider using a water softener.");
    }
    if (metrics.totalDissolvedSolids > 500) {
        recommendations.push("High TDS levels detected. Consider reverse osmosis treatment.");
    }
    if (recommendations.length === 0) {
        recommendations.push("Water quality is within acceptable ranges. Regular monitoring recommended.");
    }
    return recommendations;
}
}}),
"[project]/ (server-utils)": ((__turbopack_context__) => {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, t: __turbopack_require_real__ } = __turbopack_context__;
{
}}),

};

//# sourceMappingURL=%5Broot%20of%20the%20server%5D__1afefc._.js.map