(()=>{var e={};e.id=786,e.ids=[786],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},2934:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>h,routeModule:()=>l,serverHooks:()=>c,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>p});var a={};t.r(a),t.d(a,{POST:()=>u});var n=t(2706),i=t(8203),s=t(5994),o=t(9187);async function u(e){try{let r=(await e.formData()).get("file");if(!r||!(r instanceof Blob))return o.NextResponse.json({error:"Invalid file input. Please upload a valid image."},{status:400});let t=await r.arrayBuffer(),a=Buffer.from(t),n=Object(function(){var e=Error("Cannot find module 'sharp'");throw e.code="MODULE_NOT_FOUND",e}())(a),{width:i,height:s}=await n.metadata();if(!i||!s)throw Error("Unable to determine image dimensions");let u=await n.ensureAlpha().raw().toBuffer({resolveWithObject:!0}),l=function(e,r,t){let a=r*t,n={red:0,green:0,blue:0,brightness:0,saturation:0};for(let r=0;r<e.length;r+=4){let[t,a,i]=[e[r],e[r+1],e[r+2]];n.red+=t,n.green+=a,n.blue+=i,n.brightness+=(t+a+i)/3;let s=Math.max(t,a,i),o=Math.min(t,a,i);n.saturation+=s>0?(s-o)/s:0}let i={red:n.red/a,green:n.green/a,blue:n.blue/a,brightness:n.brightness/a,saturation:n.saturation/a,variance:0},s=["red","green","blue"],o=e.reduce((e,r,t)=>t%4<3?e+Math.pow(r-i[s[t%3]],2):e,0);return i.variance=Math.sqrt(o/(3*a)),{ph:7+i.variance/50,turbidity:i.brightness/25.5,dissolvedOxygen:Math.min(14,2*i.saturation),temperature:20+i.red/25.5,conductivity:2*i.green,totalDissolvedSolids:1.5*i.blue,chlorine:Math.min(4,i.variance/10),hardness:100*i.saturation}}(u.data,i,s),d=l.ph>=6.5&&l.ph<=8.5?"Good":"Needs Investigation",p={isDrinkable:l.ph>=6.5&&l.ph<=8.5&&l.chlorine<=4,isSwimmable:l.turbidity<5&&l.temperature>=15&&l.temperature<=30,isIrrigationSafe:l.totalDissolvedSolids<2e3},c=function(e,r){let t=[];return r.isDrinkable||t.push("Water requires treatment before consumption"),e.ph<6.5&&t.push("pH is too low, consider neutralization"),e.ph>8.5&&t.push("pH is too high, consider acid treatment"),t}(l,p);return o.NextResponse.json({overallQuality:d,metrics:l,recommendations:c,safetyStatus:p},{status:200})}catch(e){return console.error("Water quality image analysis error:",e),o.NextResponse.json({error:"Failed to analyze the image. Please try again with a different image."},{status:500})}}!function(){var e=Error("Cannot find module 'sharp'");throw e.code="MODULE_NOT_FOUND",e}();let l=new n.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/analyze/route",pathname:"/api/analyze",filename:"route",bundlePath:"app/api/analyze/route"},resolvedPagePath:"/workspaces/Water-Quality-Analyzer/app/api/analyze/route.ts",nextConfigOutput:"",userland:a}),{workAsyncStorage:d,workUnitAsyncStorage:p,serverHooks:c}=l;function h(){return(0,s.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:p})}},6487:()=>{},8335:()=>{}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[638,452],()=>t(2934));module.exports=a})();